<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>yahooï¼çŸ¥æµè¢‹ æ°´æˆ¸ä¸€ver</title>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif; margin:0; background: url("background.jpg") no-repeat center center fixed; background-size: cover; }
header { background:#7b1e2b; color:white; padding:16px 24px; }
header h1 { margin:0; font-size:22px; }
main { max-width:1100px; margin:24px auto; padding:0 16px; }
.card { background: rgba(255,255,255,0.92); border-radius:8px; padding:16px; margin-bottom:16px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
textarea, select { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:14px; }
button { background:#7b1e2b; color:white; border:none; border-radius:6px; padding:6px 12px; cursor:pointer; margin-top:6px; }
button.gray { background:#666; }
.question { font-weight:bold; margin-bottom:6px; }
.meta { font-size:11px; color:#666; }
.answer { background:#f7f7f7; border-radius:6px; padding:6px; margin-top:6px; }
.best { border:2px solid gold; }
.controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px; }
.middle { border-left:6px solid #4da3ff; }
.high { border-left:6px solid #ff9800; }
.rank { font-size:13px; margin-top:6px; }
</style>
</head>
<body>
<header>
<h1>yahooï¼çŸ¥æµè¢‹ æ°´æˆ¸ä¸€ver</h1>
<p>æ°´æˆ¸ä¸€ç”Ÿå°‚ç”¨ãƒ»åŒ¿åQ&A</p>
</header>

<main>
<!-- ãƒ­ã‚°ã‚¤ãƒ³é¸æŠç”»é¢ -->
<div class="card" id="loginSelect">
  <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
  <button onclick="showStudentLogin()">ç”Ÿå¾’ç”¨ãƒ­ã‚°ã‚¤ãƒ³</button>
  <button class="gray" onclick="showAdminLogin()">ç®¡ç†è€…ç”¨ãƒ­ã‚°ã‚¤ãƒ³</button>
</div>

<!-- ç”Ÿå¾’ç”¨ãƒ­ã‚°ã‚¤ãƒ³ -->
<div class="card" id="studentLogin" style="display:none">
  <h2>ç”Ÿå¾’ç”¨ãƒ­ã‚°ã‚¤ãƒ³</h2>
  <select id="studentGrade">
    <option>ä¸­1</option><option>ä¸­2</option><option>ä¸­3</option>
    <option>é«˜1</option><option>é«˜2</option><option>é«˜3</option>
  </select>
  <input id="studentCode" placeholder="åˆè¨€è‘‰ï¼ˆç”Ÿå¾’ç”¨ï¼‰" />
  <button onclick="loginStudent()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  <button class="gray" onclick="backToSelect()">æˆ»ã‚‹</button>
</div>

<!-- ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ -->
<div class="card admin" id="adminLogin" style="display:none">
  <h2>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
  <input id="adminPass" type="password" placeholder="ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" />
  <button onclick="loginAdmin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  <button class="gray" onclick="backToSelect()">æˆ»ã‚‹</button>
</div>

<!-- ç®¡ç†è€…ãƒ‘ãƒãƒ« -->
<div class="card" id="adminPanel" style="display:none">
  <h3>ğŸ›  ç®¡ç†è€…ãƒ‘ãƒãƒ«</h3>
  <p>é€šå ±ãŒå¤šã„æŠ•ç¨¿ã®ç¢ºèªãƒ»å‰Šé™¤ãŒã§ãã¾ã™</p>
  <div id="adminList"></div>
  <button class="gray" onclick="logoutAdmin()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
</div>

<!-- ç”Ÿå¾’ç”¨ãƒ¡ã‚¤ãƒ³ -->
<div id="studentArea" style="display:none">
  <div class="card">
    <h3>è³ªå•ã™ã‚‹</h3>
    <select id="grade"><option>ä¸­1</option><option>ä¸­2</option><option>ä¸­3</option><option>é«˜1</option><option>é«˜2</option><option>é«˜3</option></select>
    <select id="category"><option>æ•°å­¦</option><option>è‹±èª</option><option>è¡Œäº‹</option><option>ãã®ä»–</option></select>
    <textarea id="questionInput" placeholder="è³ªå•ã‚’æ›¸ã"></textarea>
    <button onclick="addQuestion()">æŠ•ç¨¿</button>
  </div>

  <div class="controls">
    <select id="gradeFilter" onchange="render()">
      <option value="all">å…¨å­¦å¹´</option>
      <option value="middle">ä¸­å­¦ç”Ÿã®ã¿</option>
      <option value="high">é«˜æ ¡ç”Ÿã®ã¿</option>
    </select>
    <select id="sort" onchange="render()">
      <option value="new">æ–°ç€é †</option>
      <option value="popular">äººæ°—é †</option>
    </select>
  </div>

  <div class="card" id="ranking"></div>
  <div id="questions"></div>
</div>
</main>

<script>
const NG=['æ­»ã­','ãƒã‚«','æ®º'];
const KEY='mito1_super';
const STUDENT_CODE='mito1chidoukai'; // ç”Ÿå¾’ç”¨åˆè¨€è‘‰ï¼ˆä»®ï¼‰
const ADMIN_PASS='naoki0817fujiyoshi'; // ç®¡ç†è€…ãƒ‘ã‚¹ï¼ˆä»®ï¼‰
let data=JSON.parse(localStorage.getItem(KEY)||'[]');
let isAdmin=false;

function save(){localStorage.setItem(KEY,JSON.stringify(data));}
function hasNG(t){return NG.some(w=>t.includes(w));}

function showStudentLogin(){ loginSelect.style.display='none'; studentLogin.style.display='block'; }
function showAdminLogin(){ loginSelect.style.display='none'; adminLogin.style.display='block'; }
function backToSelect(){ studentLogin.style.display='none'; adminLogin.style.display='none'; loginSelect.style.display='block'; }

function loginStudent(){
  if(studentCode.value!==STUDENT_CODE) return alert('åˆè¨€è‘‰ãŒé•ã„ã¾ã™');
  studentLogin.style.display='none';
  studentArea.style.display='block';
}

function loginAdmin(){
  if(adminPass.value!==ADMIN_PASS) return alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
  adminLogin.style.display='none'; adminPanel.style.display='block'; isAdmin=true;
}

function logoutAdmin(){ adminPanel.style.display='none'; loginSelect.style.display='block'; isAdmin=false; }

function addQuestion(){
 const q=questionInput.value.trim();
 if(!q||hasNG(q)) return alert('NGãƒ¯ãƒ¼ãƒ‰ã¾ãŸã¯ç©ºæ¬„');
 data.unshift({text:q,grade:grade.value,cat:category.value,time:Date.now(),answers:[]});
 questionInput.value=''; save(); render();
}

function addAnswer(i){
 const t=document.getElementById('a'+i).value.trim();
 if(!t||hasNG(t)) return alert('NGãƒ¯ãƒ¼ãƒ‰ã¾ãŸã¯ç©ºæ¬„');
 data[i].answers.push({text:t,best:false}); save(); render();
}

function best(i,j){ data[i].answers.forEach(a=>a.best=false); data[i].answers[j].best=true; save(); render(); }

function renderRanking(){
 const map={};
 data.forEach(q=>{ const k=q.grade+'-'+q.cat; map[k]=(map[k]||0)+q.answers.length; });
 const list=Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,5);
 ranking.innerHTML='<h3>ğŸ”¥ å­¦å¹´Ã—ã‚«ãƒ†ã‚´ãƒª äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>'+list.map(r=>`<div class=\'rank\'>${r[0]}ï¼š${r[1]}ä»¶</div>`).join('');
}

function render(){
 renderRanking();
 let arr=[...data];
 const gf=gradeFilter.value;
 if(gf==='middle') arr=arr.filter(q=>q.grade.startsWith('ä¸­'));
 if(gf==='high') arr=arr.filter(q=>q.grade.startsWith('é«˜'));
 if(sort.value==='popular') arr.sort((a,b)=>b.answers.length-a.answers.length);
 const box=document.getElementById('questions'); box.innerHTML='';
 arr.forEach((q,i)=>{
  const level=q.grade.startsWith('ä¸­')?'middle':'high';
  const c=document.createElement('div'); c.className='card '+level;
  c.innerHTML=`<div class='question'>Q. ${q.text}</div><div class='meta'>${q.grade}ï½œ${q.cat}ï½œå›ç­” ${q.answers.length}</div><textarea id='a${i}' placeholder='å›ç­”ã‚’æ›¸ã'></textarea><button onclick='addAnswer(${i})'>å›ç­”</button>${q.answers.map((a,j)=>`<div class='answer ${a.best?'best':''}'>${a.text}<button onclick='best(${i},${j})'>ğŸ‘</button></div>`).join('')}`;
  box.appendChild(c);
 });
}
render();
</script>
</body>
</html>
